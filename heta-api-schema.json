{
    "openapi": "3.0.0",
    "info": {
      "title": "Heta Compiler API",
      "version": "0.1.0",
      "description": "API for interacting with the Heta Compiler via HTTP."
    },
    "servers": [
      {
        "url": "https://heta-api.insysbio.com",
        "description": "Main server for Heta API"
      }
    ],
    "paths": {
      "/build": {
        "post": {
          "operationId": "buildPlatform",
          "summary": "Trigger platform compilation",
          "description": "Compiles a Heta-based platform and generates export files.",
          "requestBody": {
            "required": true,
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "lifetime": {
                      "type": "number",
                      "default": 3600,
                      "description": "Time in seconds for keeping files on the server."
                    },
                    "files": {
                      "type": "array",
                      "description": "Array of files of platform.",
                      "items": { "$ref": "#/components/schemas/File" },
                      "example": [
                        {
                          "filepath": "platform.yml",
                          "format": "binary",
                          "filebody": "<base64-encoded file content>"
                        },
                        {
                          "filepath": "index.heta",
                          "format": "text",
                          "filebody": "include model.heta;\n\n"
                        }
                      ]
                    },
                    "declaration": {
                      "type": "string",
                      "description": "The filepath to declaration file without extension. The command will search the declaration file based on option trying a set of extensions: .json/.yml.",
                      "example": "platform1"
                    },
                    "source": {
                      "type": "string",
                      "description": "Index file for compilation.",
                      "example": "index.heta"
                    },
                    "type": {
                      "type": "string",
                      "enum": ["heta", "table", "xlsx", "json", "yaml", "sbml"],
                      "description": "The type of file for compilation.",
                      "example": "heta"
                    },
                    "unitsCheck": {
                      "type": "boolean",
                      "description": "Check for unit consistency."
                    },
                    "debug": {
                      "type": "boolean",
                      "description": "Enable debugging mode."
                    },
                    "distDir": {
                      "type": "string",
                      "description": "Path for saving exported files."
                    },
                    "metaDir": {
                      "type": "string",
                      "description": "Path for saving metadata."
                    },
                    "logMode": {
                      "type": "string",
                      "enum": ["never", "error", "always"],
                      "description": "When to create a log file."
                    },
                    "export": {
                      "$ref": "#/components/schemas/Export"
                    }
                  }
                }
              }
            }
          },
          "responses": {
            "200": {
              "description": "Compilation finished.",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "filepaths": {
                        "type": "array",
                        "description": "Array of filepaths for the generated files.",
                        "items": { "type": "string" }
                      },
                      "logs": {
                        "type": "array",
                        "description": "Array of log messages.",
                        "items": { "type": "string" }
                      },
                      "taskId": {
                        "type": "string",
                        "description": "Task ID for getting files in UIDs format.",
                        "example": "5f7b1b7b-0b7b-4b7b-8b7b-0b7b7b7b7b7b"
                      },
                      "lifeend": {
                        "type": "number",
                        "description": "Time when files will be deleted in Unix timestamp seconds format.",
                        "example": 1634025600
                      }
                    }
                  }
                }
              }
            },
            "400": {
              "description": "Invalid request parameters. Request structure do not match the schema.",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "error": {
                        "type": "string",
                        "example": "Wrong format of export option."
                      }
                    }
                  }
                }
              }
            },
            "413": {
              "description": "Request entity too large. The request body is too large.",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "error": {
                        "type": "string",
                        "example": "Request files too large."
                      }
                    }
                  }
                }
              }
            },
            "429": {
              "description": "Too many requests. The server is busy.",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "error": {
                        "type": "string",
                        "example": "Too many requests. Try again later."
                      }
                    }
                  }
                }
              }
            },
            "500": {
              "description": "Internal server error.",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "error": {
                        "type": "string",
                        "example": "Internal Heta compiler error."
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "/download/{taskId}": {
        "get": {
          "operationId": "downloadFiles",
          "summary": "Download compiled files",
          "description": "Download compiled files by task ID.",
          "parameters": [
            {
              "name": "taskId",
              "in": "path",
              "required": true,
              "description": "Task ID for getting files.",
              "schema": {
                "type": "string",
                "example": "5f7b1b7b-0b7b-4b7b-8b7b-0b7b7b7b7b7b"
              }
            },
            {
              "name": "filepaths",
              "in": "query",
              "description": "Filepaths to download or `null` for all files.",
              "schema": {
                "type": "array",
                "nullable": true,
                "items": { "type": "string" },
                "example": ["dist/xlsx/table.xlsx", "dist/json/model.json"],
                "default": null
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Files are ready for download.",
              "content": {
                "application/zip": {
                  "schema": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              }
            },
            "404": {
              "description": "Files are not found.",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "error": {
                        "type": "string",
                        "example": "Files are not found."
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "delete": {
          "operationId": "deleteFiles",
          "summary": "Delete compiled files",
          "description": "Delete compiled files by task ID.",
          "parameters": [
            {
              "name": "taskId",
              "in": "path",
              "required": true,
              "description": "Task ID for getting files.",
              "schema": {
                "type": "string"
              }
            }
          ],
          "responses": {
            "200": {
              "description": "Files are deleted.",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "statusCode": {
                        "type": "number",
                        "example": 0
                      },
                      "status": {
                        "type": "string",
                        "example": "Files are deleted."
                      }
                    }
                  }
                }
              }
            },
            "404": {
              "description": "Files are not found.",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "error": {
                        "type": "string",
                        "example": "Files are not found."
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "/": {
        "get": {
          "operationId": "getInfo",
          "description": "Check connectivity and get information about the Heta Compiler.",
          "responses": {
            "200": {
              "description": "Information about the Heta Compiler.",
              "content": {
                "application/json": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "version": {
                        "type": "string",
                        "example": "1.0.0"
                      },
                      "node": {
                        "type": "string",
                        "example": "v14.17.0"
                      },
                      "description": {
                        "type": "string",
                        "example": "Heta Compiler API"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "components": {
      "schemas": {
        "Export": {
          "type": "array",
          "description": "Export formats in JSON.",
          "items": {
            "type": "object",
            "properties": {
              "format": {
                "type": "string",
                "enum": ["JSON", "YAML", "DBSolve", "SLV", "SBML", "Simbio", "Mrgsolve", "Table", "XLSX", "Julia", "Matlab", "Dot", "Summary"],
                "description": "The type of file for compilation."
              },
              "filepath": {
                "type": "string",
                "description": "Path for saving exported files.",
                "example": "model"
              },
              "spaceFilter": {
                "type": "string",
                "description": "Filter for space in RegExp format.",
                "example": "^one|two$"
              },
              "omit": {
                "type": "array",
                "description": "Array of properties paths to exclude from output. Used in JSON, YAML and Table formats.",
                "items": { "type": "string" },
                "example": ["notes", "tags"]
              },
              "noUnitsExpr": {
                "type": "boolean",
                "description": "If false or not set, all units will be written in UnitsExpr format. If true, units will be written in Unit array format. Used in JSON and YAML formats."
              },
              "powTransform": {
                "type": "string",
                "enum": ["keep", "operator", "function"],
                "description": "Transformation of x^y and pow(x, y). Used for DBSolve and SLV formats."
              },
              "version": {
                "type": "string",
                "enum": ["25", "26", "L2V3", "L2V4", "L2V5", "L3V1", "L3V2"],
                "description": "File version for SLV, DBSolve, and SBML formats."
              },
              "eventsOff": {
                "type": "boolean",
                "description": "If true, switchers will not be exported to DBSolve events. Used for SLV format."
              },
              "groupConstBy": {
                "type": "string",
                "description": "How to group const in Initial Values of DBSolve file. Written in JSON path format.",
                "example": "tags[0]"
              },
              "auxAsNotes": {
                "type": "boolean",
                "description": "If true, aux content will be appended to Simbio Notes as JSON object. Used for Simbio format."
              },
              "omitRows": {
                "type": "number",
                "description": "Creates empty rows in output sheets. Used for Table and XLSX formats.",
                "example": 3
              },
              "bookType": {
                "type": "string",
                "enum": ["xlsx", "xlsm", "xlsb", "biff8", "wk3", "csv", "txt", "sylk", "biff5", "biff4", "biff3", "biff2", "html", "dif", "dbf", "wk1", "xlml", "ods", "fods", "rtf", "prn", "eth"],
                "description": "Supported file types for Table format."
              },
              "splitByClass": {
                "type": "boolean",
                "description": "If true, components will be split by class and saved as separate sheets/files. Used for Table and XLSX formats."
              }
            }
          }
        },
        "File": {
          "type": "object",
          "properties": {
            "filepath": {
              "type": "string",
              "description": "Path to the file."
            },
            "format": {
              "type": "string",
              "enum": ["binary", "utf8"],
              "default": "text",
              "description": "The type of file for compilation."
            },
            "filebody": {
              "type": "string",
              "description": "File content as binary or plain string."
            }
          }
        }
      }
    }
}
